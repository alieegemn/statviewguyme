--===[ Ov2.5 - Open Source Client Key Validation ]===--

-- CONFIGURATION
local Identifier = "hackmanhubreal" -- Replace with your Panda Dev service identifier
local UserKey = "ff4ddd0967eb8a5912c6a3c56" -- Will be filled from user input, e.g., GUI TextBox or saved data

-- Roblox Services
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")

-- Hardware ID (HWID) - using Player.UserId here (not super secure but simple)
local localPlayer = Players.LocalPlayer
local UserID_HWID = localPlayer.UserId

-- Function to validate the key with Panda Development
local function ValidateKey(key, serviceId, hwid)
    if not HttpService then
        warn("[Ov2.5] HttpService not available.")
        return false, "HttpService not available"
    end

    local validationUrl = "https://pandadevelopment.net/v2_validation?key=" .. tostring(key) .. "&service=" .. tostring(serviceId) .. "&hwid=" .. tostring(hwid)

    local success, response = pcall(function()
        return HttpService:RequestAsync({
            Url = validationUrl,
            Method = "GET"
        })
    end)

    if success and response then
        if response.Success then
            local decodeSuccess, jsonData = pcall(function()
                return HttpService:JSONDecode(response.Body)
            end)

            if decodeSuccess and jsonData then
                if jsonData["V2_Authentication"] == "success" then
                    print("[Ov2.5] Authenticated successfully.")
                    return true, "Authenticated"
                else
                    local reason = jsonData["reason"] or "Unknown reason"
                    print("[Ov2.5] Authentication failed. Reason: " .. reason)
                    return false, "Authentication failed: " .. reason
                end
            else
                warn("[Ov2.5] Failed to decode JSON response.")
                return false, "JSON decode error"
            end
        else
            warn("[Ov2.5] HTTP request failed. Status code: " .. tostring(response.StatusCode) .. " Message: " .. response.StatusMessage)
            return false, "HTTP request failed: " .. response.StatusMessage
        end
    else
        warn("[Ov2.5] RequestAsync failed: " .. tostring(response))
        return false, "Request error"
    end
end

-- Function to generate the key retrieval URL for the user
local function GetKeyLink(serviceId, hwid)
    return "https://pandadevelopment.net/getkey?service=" .. tostring(serviceId) .. "&hwid=" .. tostring(hwid)
end

-- === USAGE EXAMPLE ===

-- Print key retrieval link so user knows where to get the key
local keyLink = GetKeyLink(Identifier, UserID_HWID)
print("To get your key, visit: " .. keyLink)

-- TODO: Replace below with your actual method to get the UserKey, e.g., GUI input
-- For testing, you can assign a valid key here manually:
-- UserKey = "your_valid_key_here"

if UserKey == "" then
    warn("[Ov2.5] UserKey is empty. Please get your key from the link above and set UserKey.")
else
    print("[Ov2.5] Validating key...")
    local isValid, message = ValidateKey(UserKey, Identifier, UserID_HWID)

    if isValid then
        print("[Ov2.5] Key is valid! Proceed with your script.")
        -- Your main script logic here
    else
        print("[Ov2.5] Key is invalid: " .. message)
        -- Handle invalid key (e.g., kick player, notify, stop script)
    end
end
